<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="å—äº¬ã€æå¿—" />
  <meta name="format-detection" content="telephone=no" />
  <title>å—äº¬ã€æå¿—</title>
  <link rel="apple-touch-icon" href="https://testingcf.jsdelivr.net/gh/nj-lizhi/song@main/audio/cover.png" />
  <link
    rel="stylesheet"
    href="https://testingcf.jsdelivr.net/npm/driver.js/dist/driver.min.css"
  />
  <link
    rel="icon"
    href="https://testingcf.jsdelivr.net/gh/nj-lizhi/song@main/audio/cover.png"
  />
  <link
    rel="stylesheet"
    href="https://testingcf.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css"
  />
  <link
    rel="stylesheet"
    href="https://testingcf.jsdelivr.net/npm/element-ui@2.15.1/lib/theme-chalk/index.css"
  />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-size: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      padding-top: max(20px, env(safe-area-inset-top));
      padding-bottom: max(20px, env(safe-area-inset-bottom));
      padding-left: max(20px, env(safe-area-inset-left));
      padding-right: max(20px, env(safe-area-inset-right));
      display: flex;
      justify-content: center;
      align-items: center;
      -webkit-overflow-scrolling: touch;
      -webkit-tap-highlight-color: transparent;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      user-select: none;
    }

    #app {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      padding: 40px;
      backdrop-filter: blur(10px);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 3.5rem;
      color: #333;
      margin-bottom: 10px;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      -webkit-user-select: none;
      user-select: none;
    }

    .header p {
      font-size: 1.4rem;
      color: #666;
      font-weight: 300;
    }

    .player-wrapper {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin-bottom: 30px;
    }

    .dplayer-video-wrap .dplayer-video {
      height: 70vh !important;
      border-radius: 10px;
      overflow: hidden;
    }

    .aplayer {
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      margin: 0 !important;
      -webkit-overflow-scrolling: touch;
    }

    .aplayer .aplayer-body,
    .aplayer .aplayer-list,
    .aplayer .aplayer-lrc {
      -webkit-overflow-scrolling: touch;
    }

    .aplayer.aplayer-fixed {
      position: relative;
      bottom: auto;
      left: auto;
      right: auto;
      margin: 0;
      max-width: 100%;
      border-radius: 15px;
    }

    .aplayer .aplayer-list {
      max-height: 400px !important;
      border-radius: 0 0 15px 15px;
    }

    /* ç¡®ä¿åˆ—è¡¨å§‹ç»ˆæ˜¾ç¤º */
    .aplayer .aplayer-list {
      display: block !important;
      opacity: 1 !important;
    }

    /* åˆ—è¡¨æŒ‰é’®æç¤º */
    .aplayer .aplayer-icon-menu::after {
      content: 'æ­Œæ›²åˆ—è¡¨';
      font-size: 12px;
      margin-left: 5px;
      font-weight: normal;
    }

    #aplayer-search {
      position: sticky;
      bottom: 0px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      cursor: auto;
      padding: 15px;
      border-radius: 0 0 15px 15px;
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    #aplayer-search input {
      flex: 1;
      min-width: 200px;
      font-size: 18px;
      border: none;
      padding: 14px 20px;
      border-radius: 25px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      -webkit-appearance: none;
      -webkit-user-select: text;
      user-select: text;
    }

    #aplayer-search input:focus {
      outline: none;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      transform: translateY(-2px);
    }

    #aplayer-search button {
      font-size: 17px;
      padding: 14px 28px;
      border: none;
      background: white;
      color: #667eea;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      -webkit-appearance: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }

    #aplayer-search button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
      background: #f8f9fa;
    }

    #aplayer-search button:active {
      transform: scale(0.95);
      background: #e9ecef;
    }

    .main {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .main .wrap-dplayer {
      flex: 1;
      min-width: 300px;
    }

    .main aside {
      flex: 0 0 300px;
      min-width: 300px;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      padding-top: 30px;
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      color: #666;
      font-size: 1.1rem;
    }

    [v-cloak] {
      display: none;
    }

    /* iOSç‰¹å®šä¼˜åŒ– */
    @supports (-webkit-touch-callout: none) {
      body {
        min-height: -webkit-fill-available;
      }
      
      .container {
        min-height: -webkit-fill-available;
      }
    }

    /* å“åº”å¼è®¾è®¡ */
    @media screen and (max-width: 768px) {
      body {
        padding: 10px;
        padding-top: max(10px, env(safe-area-inset-top));
        padding-bottom: max(10px, env(safe-area-inset-bottom));
        padding-left: max(10px, env(safe-area-inset-left));
        padding-right: max(10px, env(safe-area-inset-right));
      }

      .container {
        padding: 20px;
        border-radius: 15px;
      }

      .header h1 {
        font-size: 2.5rem;
        word-break: keep-all;
      }

      .header p {
        font-size: 1.2rem;
      }

      .player-wrapper {
        padding: 15px;
      }

      .dplayer-video-wrap .dplayer-video {
        height: 40vh !important;
      }

      .aplayer.aplayer-fixed {
        max-width: none;
      }

      .main aside {
        flex: 1 1 100%;
        width: 100%;
      }

      #aplayer-search {
        padding: 10px;
      }

      #aplayer-search input {
        min-width: 100%;
        font-size: 16px;
      }

      #aplayer-search button {
        flex: 1;
        font-size: 16px;
        padding: 12px 20px;
        min-height: 44px;
      }

      .aplayer .aplayer-list {
        max-height: 50vh !important;
      }

      /* ç§»åŠ¨ç«¯ç¡®ä¿åˆ—è¡¨å¯è§ */
      .aplayer .aplayer-list {
        display: block !important;
        opacity: 1 !important;
      }

      /* ç§»åŠ¨ç«¯åˆ—è¡¨æŒ‰é’®æç¤º */
      .aplayer .aplayer-icon-menu::after {
        content: 'åˆ—è¡¨';
        font-size: 11px;
      }
    }

    /* iPhone XåŠä»¥ä¸Šæœºå‹çš„åˆ˜æµ·å±é€‚é… */
    @media only screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3),
           only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2),
           only screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3),
           only screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3),
           only screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) {
      #aplayer-search {
        padding-bottom: max(15px, env(safe-area-inset-bottom));
      }
    }

    /* åŠ è½½åŠ¨ç”» */
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container {
      animation: fadeIn 0.6s ease-out;
    }
  </style>
</head>
<body>
  <div id="app" v-cloak>
    <div class="container">
      <div class="header">
        <h1>ğŸµ å—äº¬ã€æå¿—</h1>
        <p>è†å¬éŸ³ä¹ï¼Œæ„Ÿå—ç”Ÿæ´»</p>
      </div>
      
      <div class="player-wrapper">
        <div ref="aplayer"></div>
      </div>

      <div class="footer">
        <p>Â© 2024 éŸ³ä¹æ’­æ”¾å™¨ | ç”¨å¿ƒè†å¬æ¯ä¸€é¦–æ­Œ</p>
      </div>
    </div>
  </div>

  <script src="https://testingcf.jsdelivr.net/npm/vue@2.6.11/dist/vue.min.js"></script>
  <script src="https://testingcf.jsdelivr.net/npm/element-ui@2.15.1/lib/index.js"></script>
  <script src="https://testingcf.jsdelivr.net/npm/hls.js@0.14.4/dist/hls.min.js"></script>
  <script src="https://testingcf.jsdelivr.net/npm/dplayer@1.27.0/dist/DPlayer.min.js"></script>
  <script src="https://testingcf.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
  <script src="https://testingcf.jsdelivr.net/gh/nj-lizhi/song@main/audio/list-v2.js"></script>
  <script src="https://testingcf.jsdelivr.net/npm/driver.js/dist/driver.min.js"></script>

  <script>
    new Vue({
      el: "#app",
      data: function () {
        return {
          dp: null,
          songList: list,
          drawer: false,
          percentage: 0,
          downloading: false,
          downloadSongList: [],
          videoList: []
        };
      },
      mounted() {
        this.createAplayer();
        this.createDriver();
      },
      computed: {
        computedTableHeight() {
          return window.innerHeight - 240;
        },
        isMobile() {
          return /Android|webOS|iPhone|iPad|BlackBerry/i.test(navigator.userAgent);
        }
      },
      methods: {
        // éŸ³é¢‘æ’­æ”¾å™¨
        createAplayer() {
          this.ap = new APlayer({
            container: this.$refs.aplayer,
            audio: list,
            fixed: false,
            listMaxHeight: "400px",
            listFolded: false,  // é»˜è®¤å±•å¼€åˆ—è¡¨ï¼Œç¡®ä¿æœç´¢æ¡†å¯è§
          });
          // å¢åŠ æœç´¢
          this.addAplayerSearch();
          // ç¡®ä¿åˆ—è¡¨åœ¨ç§»åŠ¨ç«¯ä¹Ÿå±•å¼€
          setTimeout(() => {
            const listEl = this.$refs.aplayer.querySelector('.aplayer-list');
            if (listEl) {
              listEl.classList.add('aplayer-list-show');
            }
          }, 100);
        },
        // å¢åŠ éŸ³é¢‘æœç´¢
        addAplayerSearch() {
          let songListHtml = this.$refs.aplayer.querySelector("ol");
          songListHtml.innerHTML += `
            <li id="aplayer-search">
              <input type="text" placeholder="ğŸ” æœç´¢æ­Œåæˆ–ä¸“è¾‘" autocomplete="off">
              <button id="pre-song">â® ä¸Šä¸€é¦–</button>
              <button id="next-song">ä¸‹ä¸€é¦– â­</button>
            </li>
          `;
          
          // ç¡®ä¿æœç´¢æ¡†å¯è§
          setTimeout(() => {
            const searchEl = document.getElementById('aplayer-search');
            if (searchEl) {
              searchEl.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
          }, 200);
          let aplayerSearchDom = document.getElementById("aplayer-search");
          let inputSearchDom = aplayerSearchDom.querySelector("input");
          let preButtomDom = document.getElementById("pre-song");
          let nextButtomDom = document.getElementById("next-song");
          
          aplayerSearchDom.onclick = ev => {
            let onEvent = ev || event;
            onEvent.cancelBubble = true;
            onEvent.stopPropagation();
          };
          
          let indexArr = [];
          let nowIndex = null;
          
          inputSearchDom.oninput = () => {
            indexArr = [];
            nowIndex = null;
            list.forEach((item, index) => {
              if(item.name.indexOf(inputSearchDom.value) !== -1
                || item.artist.indexOf(inputSearchDom.value) !== -1
              ) {
                indexArr.push(index);
              }
            });
            if(indexArr.length > 0) {
              this.ap.list.switch(indexArr[0]);
              this.ap.pause();
              nowIndex = 0;
            }
          };
          
          preButtomDom.onclick = () => {
            if(nowIndex === 0) nowIndex = indexArr.length;
            this.ap.list.switch(indexArr[--nowIndex]);
            this.ap.pause();
          };
          
          nextButtomDom.onclick = () => {
            if(indexArr.length === nowIndex + 1) nowIndex = -1;
            this.ap.list.switch(indexArr[++nowIndex]);
            this.ap.pause();
          };
        },
        // æŒ‡å¼•
        createDriver() {
          if(document.cookie.indexOf("isFirstVisit=false") !== -1) return;
          document.cookie = "isFirstVisit=false";
          let driver = new Driver({
            animate: true,
            opacity: 0.7,
            doneBtnText: "å®Œæˆ",
            closeBtnText: "å…³é—­",
            nextBtnText: "ä¸‹ä¸€æ­¥",
            prevBtnText: "ä¸Šä¸€æ­¥",
            showButtons: true,
          });
          driver.start();
        },
        isPhone() {
          return window.screen.width < 768;
        },
      },
    });
  </script>
</body>
</html>
